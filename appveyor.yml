version: '{build}'
skip_tags: true
configuration:
#  - Debug
  - Release
environment:
  GYP_MSVS_VERSION: 2015
  # The default cpack in the PATH is not CMake
  CPACK: C:\Program Files (x86)\CMake\bin\cpack.exe
  matrix:
  - GENERATOR: Visual Studio 14 Win64
    DEPS_PATH: deps64
  - GENERATOR: Visual Studio 14
    DEPS_PATH: deps32
    BUILD_NUPKG: 1
install: []
build_script:
# See http://help.appveyor.com/discussions/problems/539-cloning-gyp-fails
- git config --global url."http://".insteadOf https://
- mkdir %DEPS_PATH%
- cd %DEPS_PATH%
- cmake -G "%GENERATOR%" -DCMAKE_BUILD_TYPE=%CONFIGURATION% ..\third-party\
- cmake --build . --config %CONFIGURATION%
- cd ..
- mkdir build
- cd build
- cmake -G "%GENERATOR%" -DCMAKE_BUILD_TYPE=%CONFIGURATION% -DDEPS_PREFIX=..\%DEPS_PATH%\usr -DCMAKE_INSTALL_PREFIX=..\INSTALL ..
- cmake --build . --config %CONFIGURATION%
- bin\nvim.exe --version
- cmake --build . --target install --config %CONFIGURATION%
- if DEFINED BUILD_NUPKG nuget pack -Version 0.0.0-pr810 ..\contrib\neovim.nuspec
- '"%CPACK%" -G NSIS -C %CONFIGURATION%'
- '"%CPACK%" -G ZIP -C %CONFIGURATION%'
nuget:
  project_feed: true
artifacts:
- path: 'build/*.nupkg'
  name: nupkgs
- path: build/Neovim.zip
- path: build/Neovim.exe
